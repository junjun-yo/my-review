<template>
    <oa-table :ajax="ajaxParams" :columns="columns"  showCheck
              @check="onCheck"  ref="table"
              >
    </oa-table>
</template>

<script>
    export default {
        props:{
            receiverId:String
        },
        data(){
            return {
                //表格异步请求数据参数
                ajaxParams: {
                    url: "/maildir/dirNameList",
                    method: "post",
                    params: {
                        receiverId: this.receiverId
                    }
                },
                //列头属性配置
                columns: [
                    {
                        label: "文件名称",
                        prop: "dirName",
                        align: "center",
                        width: ""
                    }
                ],
                checks:[],
                params:{}
            }
        },
        methods:{
            onCheck(checks) {
                this.checks=checks;
                console.log(this.checks);
            },
            confirm(done, fail) {
                let ids="";
                for(let i = 0;i<this.checks.length;i++){
                        ids =this.checks[i].id+",";
                }
                //删除文件夹
                //查询文件夹内所有的文件
                Ajax.post("/mailbox/dirMailList",{
                    receiverId: this.receiverId,
                    dirName: this.checks[0].dirName
                }).then(res =>{
                    for(let i=0;i<res.data.length;i++){
                        res.data[i].fileSaveType = "5";
                    }
                    Ajax.put("/mailbox/setFileSaveType",res.data,"json").then(()=>{
                        Ajax.delete("/maildir/deleteDirByName",{dirName:this.checks[0].dirName}).then(
                            res => {
                                if (res.success) {
                                    this.$message.success("操作成功");
                                    done();
                                }
                            },
                            err => {
                                fail();
                            }
                        );
                    })
                });
            }
        }
    }
</script>

<style scoped>

</style>