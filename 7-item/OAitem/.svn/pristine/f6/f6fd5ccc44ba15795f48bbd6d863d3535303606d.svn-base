import { transLoginInfo, resetLoginInfo } from "@/js/utils/account";

const state = {
  sysAccount: {},
  sysUser: {},
  sysDept: {},
  sysUnit: {},
  moduleList: [],
  positionList: []
};

const mutations = {
  updateSysAccount: (state, data) => {
    state.sysAccount = data;
  },
  updateSysUser: (state, data) => {
    state.sysUser = data;
  },
  updateSysDept: (state, data) => {
    state.sysDept = data;
  },
  updateSysUnit: (state, data) => {
    state.sysUnit = data;
  },
  updateModuleList: (state, data) => {
    state.moduleList = data;
  },
  updatePositionList: (state, data) => {
    state.positionList = data;
  }
};

const actions = {
  login({ commit }, userForm) {
    return new Promise((resolve, reject) => {
      Ajax.post("login/login", userForm).then(
        res => {
          transLoginInfo({ commit, loginInfo: res.data });
          resolve();
        },
        error => {
          reject(error);
        }
      );
    });
  },
  logout({ commit }) {
    return new Promise((resolve, reject) => {
      Ajax.post("login/logout").then(
        () => {
          resetLoginInfo({ commit });
          resolve();
        },
        error => {
          reject(error);
        }
      );
    });
  },
  loadInfo({ commit }) {
    return new Promise((resolve, reject) => {
      Ajax.post("common/cacheData/searchUserByRequest").then(
        res => {
          transLoginInfo({ commit, loginInfo: res.data });
          resolve();
        },
        error => {
          reject(error);
        }
      );
    });
  }
};

export default {
  namespaced: true,
  state,
  mutations,
  actions
};
